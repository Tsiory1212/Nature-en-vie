{% extends 'base_admin.html.twig' %}

{% block title %}
	Liste des produits
{% endblock %}


{% block body %}
    <div class="container mt-5">
	    <div class="container">
            {{form_start(form)}}
            <div class="row align-items-end">
                <div class="col">
                    {{form_row(form.nom)}}
                </div>
				<div class="col">
                    <button class="btn btn-primary">Recherche</button>
                </div>
            {{form_end(form)}}
        </div>

		{% for label, messages in app.flashes %}
            <div class="alert alert-{{label}} text-center">
                {% for message in messages %}
                    {{message | raw}}
                {% endfor %}
            </div>
		{% endfor %}

        <a href="{{path('admin_product_add')}}" class="btn btn-primary mt-4">Ajout produit</a>

        <table class="table table-striped table-hover">
			<thead>
				<tr class="text-center">
					<th scope="col"></th>
					<th scope="col">Nom</th>
					<th scope="col">Prix</th>
					<th scope="col">Poids</th>
					<th scope="col">Quantité</th>
					<th scope="col">Catégorie</th>
					<th scope="col">ACTION</th>
				</tr>
			</thead>
			<tbody>
				{% for produit in produits %}
					<tr>
						<td>
							{% if produit.imageName %}
						    	<img src="{{ vich_uploader_asset(produit, 'imageFile') }}" alt="card-img-top" width="50" height="50">
							{% else %}
						    	<img src="/uploads/produit/images/defaultImage.png" alt="card-img-top"  width="50" height="50" >
							{% endif %}
						</td>
						<td>{{produit.name}}</td>
						<td>{{produit.price}} €</td>
						<td>
							{% if produit.weight %}
								{{produit.weight}} Kg
							{% else %}
								-
							{% endif %}
						</td>
						<td>{{produit.quantity}}</td>
						<td>
							{% if produit.category.name is defined %}
								{{produit.category.name}}
							{% else %}
								Autre
							{% endif %}
						</td>
				        <td>
							<a href="{{path('admin_product_edit', {id: produit.id})}}" class="btn btn-secondary"> <i class="fas fa-edit"></i> </a>
                            <form method="post" action="{{path('admin_product_delete', {id: produit.id})}}" style="display: inline-block;" onsubmit="return confirm('Êtes vous vraiment sûr ?')">
                                <input type="hidden" name="_method" value="DELETE">
                                {# on injecte un token csrf pour éviter les attaques  #}
                                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ produit.id) }}">
                                <button class="btn btn-danger"><i class="fas fa-trash-alt"></i></button>
                            </form>
						</td>
					</tr>
				{% endfor %}

			</tbody>
		</table>

        <div class="pagination">
            {{ knp_pagination_render(produits)}}
        </div>
    </div>
{% endblock %}
